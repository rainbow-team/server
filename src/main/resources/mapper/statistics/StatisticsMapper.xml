<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rainbow.statistics.dao.StatisticsMapper">
  <resultMap id="BaseResultMap" type="com.rainbow.statistics.domain.ResultObj">
    <!--
      WARNING - @mbg.generated
    -->
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="value" jdbcType="VARCHAR" property="value" />
  </resultMap>


  <select id="searchResultByCommonConditon" parameterType="com.rainbow.statistics.domain.SearchCondition" resultMap="BaseResultMap">
         select a.`value` as name, ifnull(b.value,0) as value
         from ${configTableName} a
         left join
         (select c.${propertyName} as rid ,count(id) as value  from ${tableName} c group by ${propertyName}) b
         on a.id = b.rid
  </select>

    <select id="getStatisticsResultByYear" parameterType="com.rainbow.statistics.domain.SearchCondition" resultType="com.rainbow.statistics.domain.YearResultObj">
        select
         sum(case when year(t.${propertyName}) <![CDATA[  >=  ]]> 2000 then 1 else 0 end ) big,
         sum(case when year(t.${propertyName}) <![CDATA[  <  ]]>  2000 then 1 else 0 end ) small
        from  ${tableName} t
    </select>

    <select id="getStatisticsResultByBoolean" parameterType="com.rainbow.statistics.domain.SearchCondition" resultType="com.rainbow.statistics.domain.ResultObj">
         select if(t.${propertyName}=0,"否","是") as name, count(id) as value from ${tableName} t group by t.${propertyName}
    </select>

</mapper>